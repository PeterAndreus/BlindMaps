 
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>BlindMap</title>
        <link rel="icon" href="data/images/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dijit/themes/claro/claro.css">
        <link rel="stylesheet" href="http://openlayers.org/en/v3.13.1/css/ol.css" type="text/css">
        <script src="http://openlayers.org/en/v3.13.1/build/ol.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js" data-dojo-config="parseOnLoad: true"></script>

        <meta property="og:image" content="http://www.blind-map.eu/data/images/overlay_pic.png" />
        <meta property="og:title" content="Where's that country?" />
        <meta property="og:description" content="Show how good you are with geography" />
        <meta property="og:url" content="http://www.blind-map.eu" />
    </head>
    <body class="claro bodyClass">
        <style>
            html{
                min-height:100%;
                position:relative;
            }
            body{
                height:100%;
            }
            table{
                width: 100%;
            }
            td{
                height: 20px;
            }
            .dijitTitlePaneTitleFocus{
                text-align: right;
                font-family: monospace;
            }
            .divMap{
                position:absolute;
                top:0;
                bottom:0;
                left:0;
                right:0;
                overflow:hidden;
            }
            .topDiv{
                font-family: monospace;
                position: absolute;
                width: 100%;
                top: 0;
                right: 0;
                background-color: RGBA(61, 98, 121, 0.85);
            }
            .guessInput{
                width: 30px;
            }
            .center{
                text-align: center;
            }
            .right{
                text-align: right;
            }
            .height15{
                height: 15px;
            }
            .nextTaskDiv{
                position: absolute;
                bottom: -28px;
                height: 19px;
                text-align: center;
                color: white;
                background-color: rgba(135, 173, 198, 0.85);
                font-size: 16px;
                font-weight: bold;
                border: 1px solid white;
                font-family: georgia;
                right: 7px;
                padding-left: 12px;
                padding-right: 12px;
                padding-top: 3px;
                padding-bottom: 3px;
                border-radius: 5px;
            }
            .whiteBorder{
                border: 2px solid white;
            }
            .bodyClass{
                background-color: #B3E5FC;
            }
            .taskInfo{
                color: white;
                font-family: monospace;
                font-size: 1.6em;
            }
            .task{
                color: gainsboro;
                font-family: georgia;
                font-size: 3em;
                font-weight: bold;
                height: 100%;
            }
            .answerInfo{
                float: right;
                color: white;
                font-size: 10px;
                margin-right: 7px;
            }
            #taskDiv{
                margin-top: 10px;
                margin-bottom: 4px;
            }
            .flagTask{               
            }
            .areaTr{
                width: 15%;
            }
            .slider{
                width: 90%;
            }
            .claro .dijitTitlePaneTitle{
                background-color: #6599BA;
                background-image: none;
                color:white;
            }
            .claro .dijitTitlePaneTitleHover,
            .claro .dijitTitlePaneTitleOpen{
                background-color: RGBA(61, 98, 121, 0.85);
                background-image: none;
                color: white;
            }
            .claro .dijitTitlePaneContentOuter {
                background: rgba(255, 255, 255, 0.57);
                color: white;
            }
            .claro .dijitTitlePaneTitleClosed .dijitArrowNode{
                background-position: inherit;
            }
            .claro .dijitTitlePane .dijitArrowNode{
                background-image: url("data/images/menu.png");
                width: 27px;
                height: 17px;
                float: right;
                margin-top: 2px;
                margin-left: 6px;
            }
            .claro .dijitButton .dijitButtonNode{
                border: 1px solid white;
                background-color: #40647c;
                background-image: none;
                color: white;
                padding-top: 2px;
                padding-bottom: 4px;
                padding-left: 10px;
                padding-right: 10px;
                border-radius: 5px;
            }
            .claro .dijitDialogPaneContent{
                background: rgba(255, 255, 255, 0);
            }
            .claro .dijitDialogTitleBar{
                border: none;
                background-image: none;
                padding: 0;
                background-color: #6599BA;
            }
            .claro .dijitDialogCloseIcon{
                margin-top: 1px;
                right: 1px;
            }
            .aboutDialog,
            .finalDialog{
                width: 500px;
                background-color: rgba(184, 197, 204, 0.85);
                font-size: 11px;
            }
            .aboutName,
            .finalName{
                font-size: 50px;
                font-family: georgia;
                font-weight: bold;
            }
            .about{
                font-size: 3em;
            }
            .donateButton{
                position: absolute;
                bottom: 0px;
                right: 0px;
            }
            .cookieBanner{
                position: absolute;
                bottom: 0px;
                background-color:  #40647c;
                width: 100%;
                left: 0px;
                font-size: 11px;
                color: white;
                text-align: center;
            }
            .overlay{
                background-color: #40647c;
                position: absolute;
                top: 0px;
                left: 0px;
                width: 100%;
                height: 100%;
            }
            .overlayImg{
                text-align: center;
                display: inline-block;
                position: absolute;
                top: 50%;
                left: 50%;
                margin-left: -310px;
                margin-top: -200px;
            }
            .overlaySettings{
                position: absolute;
                right: 0px;
                top: 0px;
            }
            .overlayText{
                position: absolute;
                right: 32px;
                top: 38px;
            }
            .shareBtn{
                float: right;
            }
            .score{
                font-size: 20px;
                text-align: center;
            }
            .finalOkBtn
            .dijitButtonNode{
                width: 300px
            }
            .finalResetBtn
            .dijitButtonNode{
                width: 125px
            }
            .finalShareDonate{
                position: absolute;
                right: 5px;
                bottom: 41px;
            }
            .finalShare{
                float: right;
            }
            .finalDonate{
                float: right;
            }
        </style>

        <canvas style="display: none" id="imgCanvas"></canvas>
        <div class="divMap">
            <div id="map" class="map" style="height: 100%" ></div>
        </div>
        <div class="topDiv">
            <div id='settings'>
                <div data-dojo-type="dijit/form/Form" id="settingForm">
                    <div>
                        <div data-dojo-type="dijit/TitlePane" title="Settings" id="settingPane" data-dojo-props='open: false, duration: 200'>
                            <div data-dojo-type="dijit/layout/ContentPane" >
                                <div class="right">
                                    <input data-dojo-type="dijit/form/TextBox" type="hidden" name="lang" id="langInput" value="eng">
                                    <a href="javascript:void(0)" onclick="setLanguage('eng');">
                                        <img class='whiteBorder height15' src='http://www.geonames.org/flags/x/gb.gif' alt="English"/></a>
                                    <a href="javascript:void(0)" onclick="setLanguage('deu');">
                                        <img class='whiteBorder height15' src='http://www.geonames.org/flags/x/de.gif' alt="Deutsch"/></a>
                                    <a href="javascript:void(0)" onclick="setLanguage('spa');">
                                        <img class='whiteBorder height15' src='http://www.geonames.org/flags/x/es.gif' alt="España"/></a>
                                    <a href="javascript:void(0)" onclick="setLanguage('fra');">
                                        <img class='whiteBorder height15' src='http://www.geonames.org/flags/x/fr.gif' alt="France"/></a>
                                    <a href="javascript:void(0)" onclick="setLanguage('ces');">
                                        <img class='whiteBorder height15' src='http://www.geonames.org/flags/x/cz.gif' alt="Česko"/></a>
                                    <a href="javascript:void(0)" onclick="setLanguage('slk');">
                                        <img class='whiteBorder height15' src='http://www.geonames.org/flags/x/sk.gif' alt="Slovensko"/></a>
                                    &nbsp;&nbsp;&nbsp;
                                    <a href="javascript:void(0)" onclick="aboutDialog.show();">
                                        <img src="data/images/about.png" alt="about">
                                    </a>
                                </div>
                                <span localization="CountryArea"></span>
                                <table>
                                    <tr>
                                        <td>
                                            <span localization="Minimum"></span>
                                            <div data-dojo-type="dijit/form/TextBox"
                                                 name = "minArea"
                                                 onChange="changeSetting(this)"
                                                 value="5000"
                                                 placeHolder="minimal country area"></div>
                                            km<sup>2</sup>
                                        </td>
                                        <td>
                                            <input id="keepAnswer" name="keepAnswer" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="keepAnswer"><span localization="HighlightAnswer"></span></label>
                                        </td>
                                        <td>
                                            <input class="taskChckBox" id="americas" name="region" value="Americas" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="americas"><span localization="America"></span></label>
                                        </td>
                                        <td class="center" rowspan="5">
                                            <a href="javascript:void(0)" onClick="simpleMode()">
                                                <img class="whiteBorder" src="data/images/simple.png" alt="simple"><br/>
                                                <span localization="SimpleMode"></span>
                                            </a>
                                        </td>
                                        <td class="center" rowspan="5">
                                            <a href="javascript:void(0)" onClick="satMode()">
                                                <img class="whiteBorder" src="data/images/sat.png" alt="satellite"><br/>
                                                <span localization="SatelliteMode"></span>
                                            </a>
                                        </td>
                                        <td class="center" rowspan="5">
                                            <a href="javascript:void(0)" onClick="godMode()">
                                                <img class="whiteBorder" src="data/images/god.png" alt="god mode"><br/>
                                                <span localization="GodMode"></span>
                                            </a>
                                        </td>
                                        <td class="center" rowspan="5">
                                            <a href="javascript:void(0)" onClick="learnMode()">
                                                <img class="whiteBorder" src="data/images/simple.png" alt="learn mode"><br/>
                                                <span localization="LearnMode"></span>
                                            </a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span localization="Maximum"></span>
                                            <div data-dojo-type="dijit/form/TextBox"
                                                 name = "maxArea"
                                                 onChange="changeSetting(this)"
                                                 value="17098242"
                                                 placeHolder="maximal country area"></div>
                                            km<sup>2</sup>
                                        </td>
                                        <td>
                                            <input id="names" value="names" name="taskStyle" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="names"><span localization="NameTask"></span></label>
                                        </td>
                                        <td>
                                            <input class="taskChckBox" id="europe" name="region" value="Europe" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="europe"><span localization="Europe"></span></label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <input id="flags" name="taskStyle" value="flags" data-dojo-type="dijit/form/CheckBox"  onChange="changeSetting(this)"/>
                                            <label for="flags"><span localization="FlagTask"></span></label>
                                        </td>
                                        <td>
                                            <input class="taskChckBox" id="australia" name="region" value="Oceania" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="australia"><span localization="Australia"></span></label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <input id="capital" name="capitalStyle" value="capital" data-dojo-type="dijit/form/CheckBox"  onChange="changeSetting(this)"/>
                                            <label for="capital"><span localization="CapitalCity"></span></label>
                                        </td>
                                        <td>
                                            <input class="taskChckBox" id="asia" name="region" value="Asia" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="asia"><span localization="Asia"></span></label>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td>
                                            <input id="hint" name="hint" value="hint" data-dojo-type="dijit/form/CheckBox" checked onChange="dijit.byId('guessCount').set('disabled', !this.checked);
                                                    changeSetting(this);
                                                   "/>
                                            <label for="hint">
                                                <span localization="HintStart"></span>
                                                <input class="guessInput" id="guessCount" name="guessCount" value="3" data-dojo-type="dijit/form/NumberTextBox" onChange="changeSetting(this)" data-dojo-props="constraints:{min:1,max:19,places:0}"/>
                                                <span localization="HintEnd"></span>
                                            </label>
                                        </td>
                                        <td>
                                            <input class="taskChckBox" id="africa" name="region" value="Africa" data-dojo-type="dijit/form/CheckBox" checked onChange="changeSetting(this)"/>
                                            <label for="africa"><span localization="Africa"></span></label>
                                        </td>
                                    </tr>
                                </table>
                                <button data-dojo-type="dijit/form/Button" type="button"><span localization="Restart"></span>
                                    <script type="dojo/on" data-dojo-event="click" data-dojo-args="evt">
                                        initSettings(settings.lang);
                                    </script>
                                </button>
                                <div class="shareBtn">
                                    <div class="addthis_sharing_toolbox"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id='taskDiv' class="center">
                <span class='taskInfo' id='taskInfoSpan'></span>
                <span class='task' id='taskSpan'></span>
                <div class='answerInfo' id='answerInfoSpan'>
                    <table>
                        <tr>
                            <td><span localization="Correct"></span>&nbsp;</td>
                            <td>
                                <span id='correctCount'>0</span>
                            </td>
                        </tr>
                        <tr>
                            <td><span localization="Wrong"></span>&nbsp;</td>
                            <td><span id='wrongCount'>0</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            <a href="javascript:void(0)" onClick="nextTask()">
                <div class="nextTaskDiv">
                    <span localization="NextTask"></span>
                </div>
            </a>    
        </div>
        <div data-dojo-type="dijit/Dialog" 
             data-dojo-id="aboutDialog"
             class="aboutDialog">
            <div class="center aboutName">
                Blind Map
            </div>
            <div class="center">
                by Peter Andreus
            </div>
            <div><br/>
                Created with:
                <ul>
                    <li>OpenLayers 3:&nbsp;<a href="http://openlayers.org/" target="_blank">http://openlayers.org/</a></li>
                    <li>Dojo:&nbsp;<a href="https://dojotoolkit.org" target="_blank">https://dojotoolkit.org</a> </li>
                    <li>Flags are from:&nbsp;<a href="http://www.geonames.org/" target="_blank">http://www.geonames.org/</a></li>
                </ul>
                <strong>Github:</strong> <a href="https://github.com/PeterAndreus/BlindMaps" target="_blank"> https://github.com/PeterAndreus/BlindMaps</a> <br/>
                <strong>Contact:</strong> peter.andreus@gmail.com
            </div>
            <div class="donateButton">
                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                    <input type="hidden" name="cmd" value="_s-xclick">
                    <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----">
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                    <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                </form>

            </div>
            <script type="dojo/method" data-dojo-event="onBlur" data-dojo-args="evt">
                this.hide();
            </script>
        </div>
        <div data-dojo-type="dijit/Dialog"
             data-dojo-id="finalDialog"
             class="finalDialog">
            <h1 class="center finalName"><span localization="Congratulation"></span></h1>
            <div class="score" id="score"></div>
            <div>
                <div>
                    <div><strong><span localization="Correct"></span> </strong><span id="finalCorrCount"></span></div>
                    <div><strong><span localization="Wrong"></span> </strong><span id="finalWrongCount"></span></div>
                </div>
                <div class="finalShareDonate">
                    <div class="finalDonate">
                        <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                            <input type="hidden" name="cmd" value="_s-xclick">
                            <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----">
                            <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                            <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                        </form>
                    </div>
                    <div class="finalShare">
                        <div class="addthis_sharing_toolbox"></div>
                    </div>
                </div>
            </div>
            <div>
                <button data-dojo-type="dijit/form/Button" type="button" class="finalOkBtn">
                    OK
                    <script type="dojo/on" data-dojo-event="click" data-dojo-args="evt">
                        finalDialog.hide();
                    </script>
                </button>
                <button data-dojo-type="dijit/form/Button" type="button" class="finalResetBtn">
                    <span localization="Restart"></span>
                    <script type="dojo/on" data-dojo-event="click" data-dojo-args="evt">
                        initSettings(settings.lang);
                        finalDialog.hide();
                    </script>
                </button>
            </div>
            <script type="dojo/method" data-dojo-event="onShow" data-dojo-args="evt">
                dojo.byId("finalCorrCount").innerHTML = correctCounter;
                dojo.byId("finalWrongCount").innerHTML = wrongCounter;
                showScore();
            </script>
            <script type="dojo/method" data-dojo-event="onHide" data-dojo-args="evt">
                dojo.byId("score").innerHTML="";
            </script>
        </div>
        <!--ShareButtons-->
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-573d49c93c154fbc"></script>
        <!--ShareButtons-->
        <!--GoogleAnalytics-->
        <script>
                (function(i, s, o, g, r, a, m) {
                    i['GoogleAnalyticsObject'] = r;
                    i[r] = i[r] || function() {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
                    a = s.createElement(o),
                            m = s.getElementsByTagName(o)[0];
                    a.async = 1;
                    a.src = g;
                    m.parentNode.insertBefore(a, m)
                })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

                ga('create', 'UA-77532718-1', 'auto');
                ga('send', 'pageview');

        </script>
        <!--GoogleAnalytics-->
        <script>

            nls = {
                "eng": {
                    "CountryArea": "Country area:",
                    "Minimum": "Minimum",
                    "Maximum": "Maximum",
                    "HighlightAnswer": "Keep correct answer highlighted",
                    "NameTask": "Show name task",
                    "FlagTask": "Show flag task",
                    "CapitalCity": "Show capital city",
                    "HintStart": "Show a hint after",
                    "HintEnd": "wrong guesses",
                    "America": "North and South America",
                    "Europe": "Europe",
                    "Australia": "Australia",
                    "Asia": "Asia",
                    "Africa": "Africa",
                    "SimpleMode": "Simple Mode",
                    "SatelliteMode": "Sattelite Mode",
                    "GodMode": "GOD Mode",
                    "LearnMode": "Learn Mode",
                    "Settings": "Settings",
                    "Correct": "Correct",
                    "Wrong": "Wrong",
                    "Click": "Click on:",
                    "Restart": "Restart",
                    "AllAnswered": "All answered",
                    "NextTask": "Next Task",
                    "Score": "Score",
                    "Congratulation": "Congratulation"
                },
                "slk": {
                    "CountryArea": "Rozloha:",
                    "HighlightAnswer": "Ponechaj označené správne odpovede",
                    "NameTask": "Úloha s menom krajiny",
                    "FlagTask": "Úloha s vlajkou krajiny",
                    "CapitalCity": "Úloha s hlavným mestom",
                    "HintStart": "Zobraz nápovedu po",
                    "HintEnd": "zlých tipoch",
                    "America": "Severná a Južná Amerika",
                    "Europe": "Európa",
                    "Australia": "Austrália",
                    "Asia": "Ázia",
                    "Africa": "Afrika",
                    "SimpleMode": "Jednoduchý Mód",
                    "SatelliteMode": "Satelitný Mód",
                    "GodMode": "GOD Mód",
                    "LearnMode": "Mód Učenia",
                    "Settings": "Nastavenia",
                    "Correct": "Správne",
                    "Wrong": "Nesprávne",
                    "Click": "Klikni na:",
                    "Restart": "Reštart",
                    "AllAnswered": "Všetko zodpovedané",
                    "NextTask": "Ďalšia úloha",
                    "Score": "Výsledok",
                    "Congratulation": "Blahoželám!"
                },
                "ces": {
                    "CountryArea": "Rozloha krajiny",
                    "Minimum": "Minimum",
                    "Maximum": "Maximum",
                    "HighlightAnswer": "Držet správnou odpověď vyznačen",
                    "NameTask": "Úkol se zobrazením názvu",
                    "FlagTask": "Úkol se zobrazením vlajek",
                    "CapitalCity": "Zobraz hlavní město",
                    "HintStart": "Zobraz nápovědu po",
                    "HintEnd": "špatních odhadech",
                    "America": "Severní a Jižná Amerika",
                    "Europe": "Evropa",
                    "Australia": "Austrálie",
                    "Asia": "Asie",
                    "Africa": "Afrika",
                    "SimpleMode": "Jednoduchý mód",
                    "SatelliteMode": "Satelitní mód",
                    "GodMode": "GOD mód",
                    "LearnMode": "Učíci mód",
                    "Settings": "Nastavení",
                    "Correct": "Správně:",
                    "Wrong": "Špatně:",
                    "Click": "Klikni na",
                    "Restart": "Restartuj",
                    "AllAnswered": "Vše zodpovedané",
                    "NextTask": "Další úkol",
                    "Score": "Výsledek",
                    "Congratulation": "Gratuluji!"
                },
                "spa": {
                    "CountryArea": "Superficie del país:",
                    "Minimum": "Mínimo",
                    "Maximum": "Máximo",
                    "HighlightAnswer": "Mantenga respuesta correcta destacado",
                    "NameTask": "Mostrar nombre de tarea",
                    "FlagTask": "Mostrar tarea bandera",
                    "CapitalCity": "Mostrar la capital",
                    "HintStart": "Mostró un poco después de ",
                    "HintEnd": "intentos incorrectos",
                    "America": "Norte y América del Sur",
                    "Europe": "Europa",
                    "Africa": "África",
                    "SimpleMode": "Modo simple",
                    "SatelliteMode": "Modo satélite",
                    "GodMode": "Modo GOD",
                    "LearnMode": "Modo Aprender",
                    "Settings": "Ajustes",
                    "Correct": "Correcto:",
                    "Wrong": "Incorrecto:",
                    "Click": "Clic en",
                    "Restart": "Reanudar",
                    "AllAnswered": "Todo contestado",
                    "NextTask": "Siguiente tarea",
                    "Score": "Resultado",
                    "Congratulation": "Felicitaciones!"
                },
                "deu": {
                    "CountryArea": "Landesgrösse:",
                    "Maximum": "Mindestens",
                    "Minimum": "Meistens",
                    "HighlightAnswer": "Richtige Antwort angezeigt lassen",
                    "NameTask": "Namen anzeigen",
                    "FlagTask": "Landesflagge anzeigen",
                    "CapitalCity": "Hauptstadt anzeigen",
                    "HintStart": "Tipp nach ",
                    "HintEnd": "falschen Antworten",
                    "America": "Nord und Süd Amerika",
                    "Europe": "Europa",
                    "Australia": "Australien",
                    "Asia": "Asien",
                    "Africa": "Afrika",
                    "SimpleMode": "Einfacher Modus",
                    "SatelliteMode": "Satelliten-Modus",
                    "GodMode": "Gott-Modus",
                    "LearnMode": "Lerner-Modus",
                    "Settings": "Einstellungen",
                    "Correct": "Richtig:",
                    "Wrong": "Falsch:",
                    "Click": "Clicken sie:",
                    "Restart": "Neustarten",
                    "AllAnswered": "Alle beantwortet",
                    "NextTask": "Nächste Aufgabe",
                    "Score": "Ergebnis",
                    "Congratulation": "Glückwunsch!"
                },
                "fra": {
                    "CountryArea": "Zone Pays:",
                    "Minimum": "Le minimum",
                    "HighlightAnswer": "Gardez réponse correcte en surbrillance",
                    "NameTask": "Afficher le nom tâche",
                    "FlagTask": "Afficher la tâche de drapeau",
                    "CapitalCity": "Afficher la capitale",
                    "HintStart": "Afficher un soupçon après ",
                    "HintEnd": "suppositions erronées",
                    "America": "Du Nord et Amérique du Sud",
                    "Australia": "Australie",
                    "Asia": "Asie",
                    "Africa": "Afrique",
                    "SimpleMode": "Mode simple",
                    "SatelliteMode": "Mode de sattelite",
                    "GodMode": "Mode de DIEU",
                    "LearnMode": "Mode de apprendre",
                    "Settings": "Paramètres",
                    "Wrong": "Faux:",
                    "Click": "Cliquer sur:",
                    "Restart": "Redémarrer",
                    "AllAnswered": "Tous répondu",
                    "NextTask": "Tâche suivante",
                    "Congratulation": "Félicitation!"
                }
            }

            var settings;
            var countryData;
            var correctAnswers = [];
            var filteredData;
            var taskCountry;
            var highlightFeature;
            var wrongCounter = 0;
            var wrongGuess = 0;
            var correctCounter = 0;
            var UNCODE = "wb_a3_2";
            var godModeActivated = false;

            var satLayer = new ol.layer.Tile({
                source: new ol.source.MapQuest({layer: 'sat'})
            });

            var vectorLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    loader: function() {
                        var source = this;
                        var format = new ol.format.TopoJSON();
                        dojo.xhrGet({
                            url: "data/countries_topojson.json",
                            handleAs: "json",
                            load: function(data) {
                                var features = format.readFeatures(data, {
                                    featureProjection: 'EPSG:3857'
                                });
                                source.addFeatures(separateMultiPolygon(features));
                            }
                        });
                    }
                }),
                style: function(feature) {
                    return fillCountry(true);
                }
            });

            var map = new ol.Map({
                layers: [
                    vectorLayer
                ],
                target: 'map',
                view: new ol.View({
                    center: ol.proj.fromLonLat([19, 48]),
                    extent: [-9999999999, -20920774, 99999999999, 18800987],
                    zoom: 5,
                    maxZoom: 11,
                    minZoom: 3
                })
            });

            var overlayFeature = new ol.layer.Vector({
                source: new ol.source.Vector(),
                map: map,
                style: new ol.style.Style({
                    stroke: new ol.style.Stroke({
                        color: 'rgba(0,0,0,1)',
                        width: 2
                    }),
                    fill: new ol.style.Fill({
                        color: 'rgba(0,0,0,0.3)'
                    })
                })
            });

            var correctAnswerFeature = new ol.layer.Vector({
                source: new ol.source.Vector(),
                map: map,
                style: new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: 'rgba(0, 255, 0, 0.5)'
                    })
                })
            });

            var hintFeature = new ol.layer.Vector({
                source: new ol.source.Vector(),
                map: map,
                style: new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: 'rgba(0, 0, 255, 0.3)'
                    }),
                    stroke: new ol.style.Stroke({
                        color: 'rgba(0, 0, 255, 1)',
                        width: 2
                    })
                })
            });

            function learnMode() {
                simpleMode();
                settings.learn = true;
            }

            function simpleMode() {
                settings.learn = false;
                vectorLayer.setStyle(fillCountry(true));
                if (map.getLayers().getArray().indexOf(vectorLayer) === -1) {
                    map.getLayers().insertAt(1, vectorLayer);
                }
                map.removeLayer(satLayer);
                godModeActivated = false;
                dijit.byId('keepAnswer').set('checked', true);
            }

            function satMode() {
                settings.learn = false;
                vectorLayer.setStyle(fillCountry(false));
                if (map.getLayers().getArray().indexOf(vectorLayer) === -1) {
                    map.getLayers().insertAt(1, vectorLayer);
                }
                if (map.getLayers().getArray().indexOf(satLayer) === -1) {
                    map.getLayers().insertAt(0, satLayer);
                }
                godModeActivated = false;
                dijit.byId('keepAnswer').set('checked', true);
            }

            function godMode() {
                settings.learn = false;
                if (map.getLayers().getArray().indexOf(satLayer) === -1) {
                    map.getLayers().insertAt(0, satLayer);
                }
                vectorLayer.setStyle(noStyle());
                godModeActivated = true;

                dojo.forEach(overlayFeature.getSource().getFeatures(), function(feature) {
                    overlayFeature.getSource().removeFeature(feature);
                });

                dijit.byId('keepAnswer').set('checked', false);
            }

            function generateUUID() {
                var S4 = function() {
                    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
                };
                return (S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4());
            }

            function separateMultiPolygon(features) {
                var result = [];
                dojo.forEach(features, function(feature) {
                    var geom = feature.getGeometry();
                    if (geom.getType() === 'MultiPolygon') {
                        var mainFeature;
                        var mainArea = 0;
                        dojo.forEach(geom.getPolygons(), function(polygon) {
                            if (polygon.getArea() > mainArea) {
                                var clone = feature.clone();
                                clone.setGeometry(polygon);
                                mainFeature = clone;
                                mainArea = polygon.getArea();
                            }
                        });

                        mainFeature.childFeatures = [mainFeature];
                        mainFeature.mainFeature = true;

                        dojo.forEach(geom.getPolygons(), function(polygon) {
                            if (polygon.getArea() !== mainArea) {
                                var clone = feature.clone();
                                clone.setGeometry(polygon);
                                clone.parentFeature = mainFeature;
                                clone.mainFeature = false;
                                clone.setId(generateUUID());
                                result.push(clone);
                                mainFeature.childFeatures.push(clone);
                            }
                        });

                        result.push(mainFeature);
                    } else {
                        feature.mainFeature = true;
                        feature.childFeatures = [feature];
                        feature.setId(generateUUID());
                        result.push(feature);
                    }
                });

                return result;
            }

            function setLanguage(lang) {
                dojo.byId("langInput").value = lang;
                initSettings();
                localizeText();
            }

            function noStyle() {
                var s = new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: 'rgba(0, 0, 0, 0)'
                    }),
                    stroke: new ol.style.Stroke({
                        color: 'rgba(0, 0, 0, 0)',
                        width: 0.4
                    })
                });
                return  s;
            }

            function fillCountry(simple) {
                var color = 'rgba(255, 255, 255, 0.2)';
                var stroke = 'rgba(255,255,255, 1)';
                if (simple) {
                    color = '#FFF8E1';
                    stroke = 'rgba(0,0,0, 1)';
                }
                var s = new ol.style.Style({
                    fill: new ol.style.Fill({
                        color: color
                    }),
                    stroke: new ol.style.Stroke({
                        color: stroke,
                        width: 0.4
                    })
                });
                return  s;
            }

            function highlightFeatureInfo(pixel) {
                var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
                    return feature;
                });

                if (feature !== highlightFeature) {
                    if (highlightFeature && overlayFeature.getSource().getFeatures().length !== 0) {
                        overlayFeature.getSource().removeFeature(highlightFeature);
                    }
                    if (feature) {
                        overlayFeature.getSource().addFeature(feature);
                    } else {
                    }
                    highlightFeature = feature;
                }
            }

            function nameHintLayer(feature) {
                var countryName = "";
                if (feature) {
                    var country = findCountry(feature);
                    if (country.name.translations[settings.lang]) {
                        countryName = country.name.translations[settings.lang];
                    } else {
                        countryName = country.name.common;
                    }
                }

                var nameLayer = new ol.layer.Vector({
                    source: new ol.source.Vector(),
                    map: map,
                    style: new ol.style.Style({
                        text: new ol.style.Text({
                            fill: new ol.style.Fill({
                                color: 'rgba(255, 255, 255, 1)'
                            }),
                            stroke: new ol.style.Stroke({
                                color: 'rgba(0, 0, 0, 1)'
                            }),
                            text: countryName,
                            font: '20px sans-serif'
                        })
                    })
                });
                return nameLayer;
            }

            function getWrongVectorLayer() {
                var vLayer = new ol.layer.Vector({
                    source: new ol.source.Vector(),
                    map: map,
                    style: new ol.style.Style({
                        fill: new ol.style.Fill({
                            color: 'rgba(255, 0, 0, 0.5)'
                        })
                    })
                });
                return vLayer;
            }

            function findCountry(feature) {
                var result;
                dojo.forEach(countryData.features, function(country) {
                    if (feature.get(UNCODE) === country.ccn3) {
                        result = country;
                    }
                });
                return result;
            }

            function checkCorrectAnswer(pixel) {
                var feature = map.forEachFeatureAtPixel(pixel, function(feature) {
                    return feature;
                });

                if (!feature.mainFeature) {
                    feature = feature.parentFeature;
                }

                if (feature && correctAnswers.indexOf(feature.get(UNCODE)) !== -1) {
                    wrongAnswer(feature, pixel);
                    return;
                }

                if (taskCountry && feature && feature.get(UNCODE) === taskCountry.ccn3) {
                    clearHintFeature();
                    var fill = correctAnswerFeature.getStyle().getFill();
                    var keepHighlight = settings.keepAnswer.length === 0;

                    dojo.forEach(feature.childFeatures, function(childFeature) {
                        correctAnswerFeature.getSource().addFeature(childFeature);
                        if (keepHighlight) {
                            correctAnswerAnimate(fill, childFeature);
                        }
                    });

                    correctAnswers.push(taskCountry.ccn3);
                    countAnswer(true);
                    initializeTask();
                    wrongGuess = 0;
                } else if (feature) {
                    wrongAnswer(feature, pixel);
                }
            }

            function wrongAnswer(feature, pixel) {
                var nameLayer;
                var cFeature;
                var wrongAnswerFeature = getWrongVectorLayer();

                dojo.forEach(feature.childFeatures, function(childFeature) {
                    wrongAnswerFeature.getSource().addFeature(childFeature);
                });
                if (settings.learn) {
                    nameLayer = nameHintLayer(feature);

                    var coor = map.getCoordinateFromPixel(pixel);
                    var circle = new ol.geom.Circle(coor, 1, 'XY');
                    cFeature = new ol.Feature({geometry: circle});

                    nameLayer.getSource().addFeature(cFeature);
                }
                wrongAnswerAnimate(wrongAnswerFeature, nameLayer, feature.childFeatures, cFeature);
                countAnswer(false);
                wrongGuess++;
                if (settings.hint.length > 0 && wrongGuess >= settings.guessCount) {
                    showHintFeature();
                }
            }

            function clearHintFeature() {
                var featureArray = hintFeature.getSource().getFeatures();
                dojo.forEach(featureArray, function(feature) {
                    hintFeature.getSource().removeFeature(feature);
                });
            }


            function restart() {
                var vectorSource = correctAnswerFeature.getSource();
                dojo.forEach(vectorSource.getFeatures(), function(feature) {
                    vectorSource.removeFeature(feature);
                });
                clearHintFeature();
                correctAnswers = [];
                resetCounter();
                filterDataByCriteria();
            }

            function nextTask() {
                initializeTask();
            }

            function destroyLayer(layer) {
                if (layer) {
                    map.removeLayer(layer);
                    layer = null;
                }
            }

            map.on('pointermove', function(evt) {
                if (evt.dragging) {
                    return;
                }
                var pixel = map.getEventPixel(evt.originalEvent);
                if (!godModeActivated) {
                    highlightFeatureInfo(pixel);
                }
            });

            map.on('click', function(evt) {
                checkCorrectAnswer(evt.pixel);
            });
        </script>
        <script>
            require(["dojo/_base/array", "dojo/dom", "dijit/registry", "dojo/dom-class", "dojo/hash", "dojo/number"], function(array, dom, registry, domClass, hash, number) {
                changeSetting = function() {
                    initSettings(settings.lang);
                    if (settings.region.length === 1) {
                        dojo.query(".taskChckBox").forEach(function(node) {
                            var widget = dijit.getEnclosingWidget(node);
                            if (widget.checked) {
                                widget.readOnly = true;
                            }
                        });
                    } else {
                        dojo.query(".taskChckBox").forEach(function(node) {
                            var widget = dijit.getEnclosingWidget(node);
                            widget.readOnly = false;
                        });
                    }
                }

                initSettings = function(lang) {
                    var form = registry.byId("settingForm");
                    settings = form.get("value");
                    settings.answered = false;
                    if (lang) {
                        settings.lang = lang;
                    } else if (!settings.lang) {
                        settings.lang = "eng";
                    }
                    if (settings.taskStyle.indexOf("flags") !== -1) {
                        domClass.add("taskDiv", "flagTask");
                    } else {
                        domClass.remove("taskDiv", "flagTask");
                    }
                    restart();
                }

                filterDataByCriteria = function() {
                    filteredData = dojo.filter(countryData.features, function(item) {
                        var region = settings.region.indexOf(item.region) !== -1;
                        if (item.region instanceof Array) {
                            dojo.forEach(item.region, function(regionItem) {
                                if (settings.region.indexOf(regionItem) !== -1) {
                                    region = true;
                                }
                            })
                        }
                        return region &&
                                item.area <= settings.maxArea &&
                                item.area >= settings.minArea;
                    });
                    initializeTask();
                }

                initializeTask = function() {
                    wrongGuess = 0;
                    var taskSpan = dom.byId("taskSpan");
                    var taskInfoSpan = dom.byId("taskInfoSpan");
                    if (correctAnswers.length !== filteredData.length) {
                        var country = getRandomCountry();
                        var taskSpanValue = "";
                        if (settings && nls[settings.lang].Click) {
                            taskInfoSpan.innerHTML = nls[settings.lang].Click;
                        } else {
                            taskInfoSpan.innerHTML = nls.eng.Click;
                        }
                        if (settings.taskStyle.indexOf("flags") !== -1) {
                            taskSpanValue += "<img class='whiteBorder' src='http://www.geonames.org/flags/x/" + country.cca2.toLowerCase() + ".gif' height='60px'/> &nbsp;";
                        }
                        if (settings.taskStyle.indexOf("names") !== -1) {
                            if (country.name.translations[settings.lang]) {
                                taskSpanValue += country.name.translations[settings.lang];
                            } else {
                                taskSpanValue += country.name.common;
                            }
                        }
                        if (settings.capitalStyle.indexOf("capital") !== -1) {
                            if (settings.taskStyle.indexOf("names") !== -1
                                    || settings.taskStyle.indexOf("flags") !== -1) {
                                taskSpanValue += "&nbsp - &nbsp";
                            }
                            if (country.capital.translations[settings.lang]) {
                                taskSpanValue += country.capital.translations[settings.lang];
                            } else {
                                taskSpanValue += country.capital.official;
                            }
                        }
                        taskSpan.innerHTML = taskSpanValue;
                        taskCountry = country;
                    } else {
                        settings.answered = true;
                        taskInfoSpan.innerHTML = "";
                        if (settings && nls[settings.lang].AllAnswered) {
                            taskSpan.innerHTML = nls[settings.lang].AllAnswered;
                        } else {
                            taskSpan.innerHTML = nls.eng.AllAnswered;
                        }
                        finalDialog.show();
                    }
                };

                getRandomCountry = function() {
                    var randomNum = Math.floor(Math.random() * filteredData.length);
                    var country = filteredData[randomNum];
                    if (correctAnswers.indexOf(country.ccn3) !== -1 || country.ccn3 === "") {
                        country = getRandomCountry();
                    }
                    return country;
                }

                showHintFeature = function() {
                    var alreadyPainted = false;
                    var mainFeature = array.filter(vectorLayer.getSource().getFeatures(), function(feature) {
                        if (feature.get(UNCODE) === taskCountry.ccn3) {
                            return feature.mainFeature;
                        }
                    });
                    array.forEach(hintFeature.getSource().getFeatures(), function(feature) {
                        if (feature === mainFeature[0]) {
                            alreadyPainted = true;
                        }
                    })
                    if (!alreadyPainted) {
                        if (taskCountry.area < 6000) {
                            var coor = ol.extent.getCenter(mainFeature[0].getGeometry().getExtent());
                            var circle = new ol.geom.Circle(coor, 70000, 'XY');
                            var cFeature = new ol.Feature({geometry: circle});
                            cFeature.set(UNCODE, mainFeature[0].get(UNCODE));
                            cFeature.parentFeature = mainFeature[0];
                            cFeature.mainFeature = false;
                            hintFeature.getSource().addFeature(cFeature);
                        } else {
                            array.forEach(mainFeature[0].childFeatures, function(childFeature) {
                                hintFeature.getSource().addFeature(childFeature);
                            });
                        }
                    }
                }

                correctAnswerAnimate = function(fill, feature) {
                    var interval = 25;
                    var timer = new dojox.timing.Timer(interval);
                    timer.alpha = 0.5;
                    timer.tickCount = 0;
                    timer.fill = fill;
                    timer.feature = feature;
                    timer.onTick = function() {
                        timer.tickCount++;
                        var alpha = timer.alpha - (timer.alpha / interval * timer.tickCount);
                        timer.fill.setColor('rgba(0, 255, 0, ' + alpha + ')');

                        correctAnswerFeature.getSource().removeFeature(feature);
                        correctAnswerFeature.getSource().addFeature(feature);

                        if (alpha === 0) {
                            correctAnswerFeature.getSource().removeFeature(feature);
                            timer.fill.setColor('rgba(0, 255, 0, ' + timer.alpha + ')');
                            timer.stop();
                        }
                    };
                    timer.start();
                };

                wrongAnswerAnimate = function(wrongAnswerFeature, nameFeature, featureList, cFeature) {
                    var interval = 25;
                    var timer = new dojox.timing.Timer(interval);
                    timer.alpha = 0.5;
                    timer.tickCount = 0;
                    timer.fill = wrongAnswerFeature.getStyle().getFill();
                    if (nameFeature) {
                        timer.nameTextFill = nameFeature.getStyle().getText().getFill();
                        timer.nameTextStroke = nameFeature.getStyle().getText().getStroke();
                    }
                    timer.onTick = function() {
                        this.tickCount++;
                        var alpha = this.alpha - (this.alpha / interval * this.tickCount);
                        this.fill.setColor('rgba(255, 0, 0, ' + alpha + ')');
                        var that = this;
                        dojo.forEach(featureList, function(feature) {
                            if (alpha === 0 && feature) {
                                that.fill.setColor('rgba(255, 0, 0, 0)');
                                destroyLayer(wrongAnswerFeature);
                                if (that.isRunning) {
                                    that.stop();
                                }
                            }
                            wrongAnswerFeature.getSource().removeFeature(feature);
                            wrongAnswerFeature.getSource().addFeature(feature);
                        });
                        if (nameFeature) {
                            if (alpha === 0) {
                                that.nameTextFill.setColor('rgba(255, 255, 255, 0)');
                                that.nameTextStroke.setColor('rgba(0, 0, 0, 0)');
                                destroyLayer(nameFeature);
                            }
                            this.nameTextFill.setColor('rgba(255, 255, 255, ' + alpha*2 + ')');
                            this.nameTextStroke.setColor('rgba(0, 0, 0, ' + alpha*2 + ')');
                            nameFeature.getSource().removeFeature(cFeature);
                            nameFeature.getSource().addFeature(cFeature);
                        }
                    };
                    timer.start();
                };

                showScore = function() {
                    if (settings.answered) {
                        var text = "Score: ";
                        if (settings && nls[settings.lang].Score) {
                            text = nls[settings.lang].Score + ": ";
                        }
                        var div = dojo.byId("score");
                        var score = 0;
                        var color = "rgb(255, 0, 0)";
                        var html = "<span style='color:" + color + "'>" + text + score + "</span>";

                        var finalScore = number.round(100 - (200 * wrongCounter / correctCounter), 2);
                        var tmpScore = 0;
                        var endAnimation = false;

                        var interval = 25;
                        var timer = new dojox.timing.Timer(interval);
                        timer.onTick = function() {
                            var c = tmpScore * 1.67;
                            color = "rgb(" + Math.ceil((168 - c)) + ", " + Math.ceil((0 + c)) + ", 0)";
                            html = "<span style='color:" + color + "'>" + text + tmpScore + "</span>";

                            div.innerHTML = html;
                            if (endAnimation) {
                                timer.stop();
                            }
                            tmpScore++;
                            if (finalScore < tmpScore) {
                                tmpScore = finalScore < 0 ? 0 : finalScore;
                                endAnimation = true;
                            }
                        }
                        timer.start();
                        var region = settings.region.length === 5 ? "World" : settings.region.toString();
                        var newDesc = "My score for " + region + " is " + finalScore + "! How about you?";

                        dojo.query("[property='og:description']")[0].content = newDesc;
                    }
                }

//                generateImage = function() {
//                    var finalScore = 100 - (200 * wrongCounter / correctCounter);
//                    finalScore = finalScore < 0 ? 0 : finalScore;
//                    var text = "Score: ";
//                    if (settings && nls[settings.lang].Score) {
//                        text = nls[settings.lang].Score + ": ";
//                    }
//
//                    var canvas = document.getElementById("imgCanvas");
//                    canvas.width = 619;
//                    canvas.height = 400;
//                    var context = canvas.getContext("2d");
//
//                    var imageObj = new Image();
//                    imageObj.onload = function() {
//                        context.drawImage(imageObj, 0, 0);
//                        context.font = "90px Georgia";
//                        context.fillStyle = "gainsboro";
//                        context.fillText(text, 80, 220);
//                        context.strokeStyle = "white";
//                        context.strokeText(text, 80, 220);
//
//                        context.fillStyle = "rgb(" + Math.ceil((168 - finalScore)) + ", " + Math.ceil((0 + finalScore)) + ", 0";
//                        context.fillText(finalScore, 200, 320);
//                        context.strokeText(finalScore, 200, 320);
//                    };
//                    imageObj.src = "data/images/overlay_pic.png";
//
//                }

                countAnswer = function(correct) {
                    if (correct) {
                        var c = dom.byId('correctCount');
                        correctCounter++;
                        c.innerHTML = correctCounter;
                    } else {
                        var w = dom.byId('wrongCount');
                        wrongCounter++;
                        w.innerHTML = wrongCounter;
                    }
                }

                resetCounter = function() {
                    var c = dom.byId('correctCount');
                    var w = dom.byId('wrongCount');
                    c.innerHTML = "0";
                    w.innerHTML = "0";
                    wrongCounter = 0;
                    correctCounter = 0;
                }

                localizeText = function() {
                    dojo.query("span[localization]").forEach(function(span) {
                        var l = dojo.attr(span, "localization");
                        var v;
                        if (nls[settings.lang][l]) {
                            v = nls[settings.lang][l];
                        } else {
                            v = nls.eng[l];
                        }
                        span.innerHTML = v;
                    });
                    if (nls[settings.lang].Settings) {
                        dijit.byId("settingPane").set("title", nls[settings.lang].Settings);
                    } else {
                        dijit.byId("settingPane").set("title", nls["eng"].Settings);
                    }
                    hash(settings.lang);
                }
            });
        </script>

        <script>
            require(["dojo/request/xhr", "dojo/_base/fx", "dojo/ready", "dojo/hash"], function(xhr, fx, ready, hash) {
                ready(function() {
                    dojo.require("dojox.timing");
                    xhr("data/countries.json",
                            {handleAs: "json"})
                            .then(function(data) {
                                var availableLang = ["slk", "eng", "ces", "spa", "fra", "deu"];
                                var lang = availableLang.indexOf(hash()) !== -1 ? hash() : "eng";
                                countryData = data;
                                initSettings(lang);
                                localizeText();
                                fx.animateProperty({
                                    node: "overlay",
                                    duration: 1300,
                                    properties: {
                                        opacity: {start: 1, end: 0}
                                    },
                                    onEnd: function() {
                                        dojo.destroy('overlay');
                                        setTimeout(
                                                function() {
                                                    fx.animateProperty({
                                                        node: "cookieBanner",
                                                        duration: 1300,
                                                        properties: {
                                                            opacity: {start: 1, end: 0}
                                                        },
                                                        onEnd: function() {
                                                            dojo.destroy('cookieBanner');

                                                        }
                                                    }).play();
                                                }
                                        , 8000);
                                    }
                                }).play();
                            });
                })
            });
        </script>

        <div id="overlay" class="overlay">
            <div class="overlayImg">
                <img src="data/images/overlay_pic.png" alt="overlayMap">
                <br/><br/>
                <img src="data/images/Loading.gif" alt="loading">
            </div>
            <div class="overlaySettings">
                <img src="data/images/overlaySettings.png" alt="setting">
            </div>
            <div class="overlayText">
                <img src="data/images/textArrow.png" alt="txtArrow">
            </div>
        </div>
        <div id="cookieBanner" class="cookieBanner">
            By visiting the site, you accept our use of cookies.
        </div>
    </body>
</html>