function learnMode(){simpleMode(),settings.learn=!0}function simpleMode(){settings.learn=!1,vectorLayer.setStyle(fillCountry(!0)),map.getLayers().getArray().indexOf(vectorLayer)===-1&&map.getLayers().insertAt(1,vectorLayer),map.removeLayer(satLayer),godModeActivated=!1,dijit.byId("keepAnswer").set("checked",!0)}function satMode(){settings.learn=!1,vectorLayer.setStyle(fillCountry(!1)),map.getLayers().getArray().indexOf(vectorLayer)===-1&&map.getLayers().insertAt(1,vectorLayer),map.getLayers().getArray().indexOf(satLayer)===-1&&map.getLayers().insertAt(0,satLayer),godModeActivated=!1,dijit.byId("keepAnswer").set("checked",!0)}function godMode(){settings.learn=!1,map.getLayers().getArray().indexOf(satLayer)===-1&&map.getLayers().insertAt(0,satLayer),vectorLayer.setStyle(noStyle()),godModeActivated=!0,dojo.forEach(overlayFeature.getSource().getFeatures(),function(a){overlayFeature.getSource().removeFeature(a)}),dijit.byId("keepAnswer").set("checked",!1)}function generateUUID(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function separateMultiPolygon(a){var b=[];return dojo.forEach(a,function(a){var c=a.getGeometry();if("MultiPolygon"===c.getType()){var d,e=0;dojo.forEach(c.getPolygons(),function(b){if(b.getArea()>e){var c=a.clone();c.setGeometry(b),d=c,e=b.getArea()}}),d.childFeatures=[d],d.mainFeature=!0,dojo.forEach(c.getPolygons(),function(c){if(c.getArea()!==e){var f=a.clone();f.setGeometry(c),f.parentFeature=d,f.mainFeature=!1,f.setId(generateUUID()),b.push(f),d.childFeatures.push(f)}}),b.push(d)}else a.mainFeature=!0,a.childFeatures=[a],a.setId(generateUUID()),b.push(a)}),b}function setLanguage(a){dojo.byId("langInput").value=a,initSettings(),localizeText()}function noStyle(){var a=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0, 0, 0, 0)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0)",width:.4})});return a}function fillCountry(a){var b="rgba(255, 255, 255, 0.2)",c="rgba(255,255,255, 1)";a&&(b="#FFF8E1",c="rgba(0,0,0, 1)");var d=new ol.style.Style({fill:new ol.style.Fill({color:b}),stroke:new ol.style.Stroke({color:c,width:.4})});return d}function highlightFeatureInfo(a){var b=map.forEachFeatureAtPixel(a,function(a){return a});b!==highlightFeature&&(highlightFeature&&0!==overlayFeature.getSource().getFeatures().length&&overlayFeature.getSource().removeFeature(highlightFeature),b&&overlayFeature.getSource().addFeature(b),highlightFeature=b)}function nameHintLayer(a){var b="";if(a){var c=findCountry(a);b=c.name.translations[settings.lang]?c.name.translations[settings.lang]:c.name.common}var d=new ol.layer.Vector({source:new ol.source.Vector,map:map,style:new ol.style.Style({text:new ol.style.Text({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 1)"}),text:b,font:"20px sans-serif"})})});return d}function getWrongVectorLayer(){var a=new ol.layer.Vector({source:new ol.source.Vector,map:map,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.5)"})})});return a}function findCountry(a){var b;return dojo.forEach(countryData.features,function(c){a.get(UNCODE)===c.ccn3&&(b=c)}),b}function checkCorrectAnswer(a){var b=map.forEachFeatureAtPixel(a,function(a){return a});if(b.mainFeature||(b=b.parentFeature),b&&correctAnswers.indexOf(b.get(UNCODE))!==-1)return void wrongAnswer(b,a);if(taskCountry&&b&&b.get(UNCODE)===taskCountry.ccn3){clearHintFeature();var c=correctAnswerFeature.getStyle().getFill(),d=0===settings.keepAnswer.length;dojo.forEach(b.childFeatures,function(a){correctAnswerFeature.getSource().addFeature(a),d&&correctAnswerAnimate(c,a)}),correctAnswers.push(taskCountry.ccn3),countAnswer(!0),initializeTask(),wrongGuess=0}else b&&wrongAnswer(b,a)}function wrongAnswer(a,b){var c,d,e=getWrongVectorLayer();if(dojo.forEach(a.childFeatures,function(a){e.getSource().addFeature(a)}),settings.learn){c=nameHintLayer(a);var f=map.getCoordinateFromPixel(b),g=new ol.geom.Circle(f,1,"XY");d=new ol.Feature({geometry:g}),c.getSource().addFeature(d)}wrongAnswerAnimate(e,c,a.childFeatures,d),countAnswer(!1),wrongGuess++,settings.hint.length>0&&wrongGuess>=settings.guessCount&&showHintFeature()}function clearHintFeature(){var a=hintFeature.getSource().getFeatures();dojo.forEach(a,function(a){hintFeature.getSource().removeFeature(a)})}function restart(){var a=correctAnswerFeature.getSource();dojo.forEach(a.getFeatures(),function(b){a.removeFeature(b)}),clearHintFeature(),correctAnswers=[],resetCounter(),filterDataByCriteria()}function nextTask(){initializeTask()}function destroyLayer(a){a&&(map.removeLayer(a),a=null)}require(["dojo/_base/array","dojo/dom","dijit/registry","dojo/dom-class","dojo/hash","dojo/number"],function(a,b,c,d,e,f){changeSetting=function(){initSettings(settings.lang),1===settings.region.length?dojo.query(".taskChckBox").forEach(function(a){var b=dijit.getEnclosingWidget(a);b.checked&&(b.readOnly=!0)}):dojo.query(".taskChckBox").forEach(function(a){var b=dijit.getEnclosingWidget(a);b.readOnly=!1})},initSettings=function(a){var b=c.byId("settingForm"),e=!!settings&&settings.learn;settings=b.get("value"),settings.learn=e,settings.answered=!1,a?settings.lang=a:settings.lang||(settings.lang="eng"),settings.taskStyle.indexOf("flags")!==-1?d.add("taskDiv","flagTask"):d.remove("taskDiv","flagTask"),restart()},filterDataByCriteria=function(){filteredData=dojo.filter(countryData.features,function(a){var b=settings.region.indexOf(a.region)!==-1;return a.region instanceof Array&&dojo.forEach(a.region,function(a){settings.region.indexOf(a)!==-1&&(b=!0)}),b&&a.area<=settings.maxArea&&a.area>=settings.minArea}),initializeTask()},initializeTask=function(){wrongGuess=0;var a=b.byId("taskSpan"),c=b.byId("taskInfoSpan");if(correctAnswers.length!==filteredData.length){var d=getRandomCountry(),e="";settings&&nls[settings.lang].Click?c.innerHTML=nls[settings.lang].Click:c.innerHTML=nls.eng.Click,settings.taskStyle.indexOf("flags")!==-1&&(e+="<img class='whiteBorder' src='http://www.geonames.org/flags/x/"+d.cca2.toLowerCase()+".gif' height='60px'/> &nbsp;"),settings.taskStyle.indexOf("names")!==-1&&(e+=d.name.translations[settings.lang]?d.name.translations[settings.lang]:d.name.common),settings.capitalStyle.indexOf("capital")!==-1&&(settings.taskStyle.indexOf("names")===-1&&settings.taskStyle.indexOf("flags")===-1||(e+="&nbsp - &nbsp"),e+=d.capital.translations[settings.lang]?d.capital.translations[settings.lang]:d.capital.official),a.innerHTML=e,taskCountry=d}else settings.answered=!0,c.innerHTML="",settings&&nls[settings.lang].AllAnswered?a.innerHTML=nls[settings.lang].AllAnswered:a.innerHTML=nls.eng.AllAnswered,finalDialog.show()},getRandomCountry=function(){var a=Math.floor(Math.random()*filteredData.length),b=filteredData[a];return correctAnswers.indexOf(b.ccn3)===-1&&""!==b.ccn3||(b=getRandomCountry()),b},showHintFeature=function(){var b=!1,c=a.filter(vectorLayer.getSource().getFeatures(),function(a){if(a.get(UNCODE)===taskCountry.ccn3)return a.mainFeature});if(a.forEach(hintFeature.getSource().getFeatures(),function(a){a===c[0]&&(b=!0)}),!b)if(taskCountry.area<6e3){var d=ol.extent.getCenter(c[0].getGeometry().getExtent()),e=new ol.geom.Circle(d,7e4,"XY"),f=new ol.Feature({geometry:e});f.set(UNCODE,c[0].get(UNCODE)),f.parentFeature=c[0],f.mainFeature=!1,hintFeature.getSource().addFeature(f)}else a.forEach(c[0].childFeatures,function(a){hintFeature.getSource().addFeature(a)})},correctAnswerAnimate=function(a,b){var c=25,d=new dojox.timing.Timer(c);d.alpha=.5,d.tickCount=0,d.fill=a,d.feature=b,d.onTick=function(){d.tickCount++;var a=d.alpha-d.alpha/c*d.tickCount;d.fill.setColor("rgba(0, 255, 0, "+a+")"),correctAnswerFeature.getSource().removeFeature(b),correctAnswerFeature.getSource().addFeature(b),0===a&&(correctAnswerFeature.getSource().removeFeature(b),d.fill.setColor("rgba(0, 255, 0, "+d.alpha+")"),d.stop())},d.start()},wrongAnswerAnimate=function(a,b,c,d){var e=25,f=new dojox.timing.Timer(e);f.alpha=.5,f.tickCount=0,f.fill=a.getStyle().getFill(),b&&(f.nameTextFill=b.getStyle().getText().getFill(),f.nameTextStroke=b.getStyle().getText().getStroke()),f.onTick=function(){this.tickCount++;var f=this.alpha-this.alpha/e*this.tickCount;this.fill.setColor("rgba(255, 0, 0, "+f+")");var g=this;dojo.forEach(c,function(b){0===f&&b&&(g.fill.setColor("rgba(255, 0, 0, 0)"),destroyLayer(a),g.isRunning&&g.stop()),a.getSource().removeFeature(b),a.getSource().addFeature(b)}),b&&(0===f&&(g.nameTextFill.setColor("rgba(255, 255, 255, 0)"),g.nameTextStroke.setColor("rgba(0, 0, 0, 0)"),destroyLayer(b)),this.nameTextFill.setColor("rgba(255, 255, 255, "+2*f+")"),this.nameTextStroke.setColor("rgba(0, 0, 0, "+2*f+")"),b.getSource().removeFeature(d),b.getSource().addFeature(d))},f.start()},showScore=function(){if(settings.answered){var a="Score: ";settings&&nls[settings.lang].Score&&(a=nls[settings.lang].Score+": ");var b=dojo.byId("score"),c=0,d="rgb(255, 0, 0)",e="<span style='color:"+d+"'>"+a+c+"</span>",g=f.round(100-200*wrongCounter/correctCounter,2),h=0,i=!1,j=25,k=new dojox.timing.Timer(j);k.onTick=function(){var c=1.67*h;d="rgb("+Math.ceil(168-c)+", "+Math.ceil(0+c)+", 0)",e="<span style='color:"+d+"'>"+a+h+"</span>",b.innerHTML=e,i&&k.stop(),h++,g<h&&(h=g<0?0:g,i=!0)},k.start();var l=5===settings.region.length?"World":settings.region.toString(),m="My score for "+l+" is "+g+"! How about you?";dojo.query("[property='og:description']")[0].content=m}},countAnswer=function(a){if(a){var c=b.byId("correctCount");correctCounter++,c.innerHTML=correctCounter}else{var d=b.byId("wrongCount");wrongCounter++,d.innerHTML=wrongCounter}},resetCounter=function(){var a=b.byId("correctCount"),c=b.byId("wrongCount");a.innerHTML="0",c.innerHTML="0",wrongCounter=0,correctCounter=0},localizeText=function(){dojo.query("span[localization]").forEach(function(a){var c,b=dojo.attr(a,"localization");c=nls[settings.lang][b]?nls[settings.lang][b]:nls.eng[b],a.innerHTML=c}),nls[settings.lang].Settings?dijit.byId("settingPane").set("title",nls[settings.lang].Settings):dijit.byId("settingPane").set("title",nls.eng.Settings),e(settings.lang)}}),nls={eng:{CountryArea:"Country area:",Minimum:"Minimum",Maximum:"Maximum",HighlightAnswer:"Keep correct answer highlighted",NameTask:"Show name task",FlagTask:"Show flag task",CapitalCity:"Show capital city",HintStart:"Show a hint after",HintEnd:"wrong guesses",America:"North and South America",Europe:"Europe",Australia:"Australia",Asia:"Asia",Africa:"Africa",SimpleMode:"Simple Mode",SatelliteMode:"Sattelite Mode",GodMode:"GOD Mode",LearnMode:"Learn Mode",Settings:"Settings",Correct:"Correct",Wrong:"Wrong",Click:"Click on:",Restart:"Restart",AllAnswered:"All answered",NextTask:"Next Task",Score:"Score",Congratulation:"Congratulation"},slk:{CountryArea:"Rozloha:",HighlightAnswer:"Ponechaj označené správne odpovede",NameTask:"Úloha s menom krajiny",FlagTask:"Úloha s vlajkou krajiny",CapitalCity:"Úloha s hlavným mestom",HintStart:"Zobraz nápovedu po",HintEnd:"zlých tipoch",America:"Severná a Južná Amerika",Europe:"Európa",Australia:"Austrália",Asia:"Ázia",Africa:"Afrika",SimpleMode:"Jednoduchý Mód",SatelliteMode:"Satelitný Mód",GodMode:"GOD Mód",LearnMode:"Mód Učenia",Settings:"Nastavenia",Correct:"Správne",Wrong:"Nesprávne",Click:"Klikni na:",Restart:"Reštart",AllAnswered:"Všetko zodpovedané",NextTask:"Ďalšia úloha",Score:"Výsledok",Congratulation:"Blahoželám!"},ces:{CountryArea:"Rozloha krajiny",Minimum:"Minimum",Maximum:"Maximum",HighlightAnswer:"Držet správnou odpověď vyznačen",NameTask:"Úkol se zobrazením názvu",FlagTask:"Úkol se zobrazením vlajek",CapitalCity:"Zobraz hlavní město",HintStart:"Zobraz nápovědu po",HintEnd:"špatních odhadech",America:"Severní a Jižná Amerika",Europe:"Evropa",Australia:"Austrálie",Asia:"Asie",Africa:"Afrika",SimpleMode:"Jednoduchý mód",SatelliteMode:"Satelitní mód",GodMode:"GOD mód",LearnMode:"Učíci mód",Settings:"Nastavení",Correct:"Správně:",Wrong:"Špatně:",Click:"Klikni na",Restart:"Restartuj",AllAnswered:"Vše zodpovedané",NextTask:"Další úkol",Score:"Výsledek",Congratulation:"Gratuluji!"},spa:{CountryArea:"Superficie del país:",Minimum:"Mínimo",Maximum:"Máximo",HighlightAnswer:"Mantenga respuesta correcta destacado",NameTask:"Mostrar nombre de tarea",FlagTask:"Mostrar tarea bandera",CapitalCity:"Mostrar la capital",HintStart:"Mostró un poco después de ",HintEnd:"intentos incorrectos",America:"Norte y América del Sur",Europe:"Europa",Africa:"África",SimpleMode:"Modo simple",SatelliteMode:"Modo satélite",GodMode:"Modo GOD",LearnMode:"Modo Aprender",Settings:"Ajustes",Correct:"Correcto:",Wrong:"Incorrecto:",Click:"Clic en",Restart:"Reanudar",AllAnswered:"Todo contestado",NextTask:"Siguiente tarea",Score:"Resultado",Congratulation:"Felicitaciones!"},deu:{CountryArea:"Landesgrösse:",Maximum:"Maximum",Minimum:"Minimum",HighlightAnswer:"Richtige Antwort angezeigt lassen",NameTask:"Namen anzeigen",FlagTask:"Landesflagge anzeigen",CapitalCity:"Hauptstadt anzeigen",HintStart:"Tipp nach ",HintEnd:"falschen Antworten",America:"Nord- und Südamerika",Europe:"Europa",Australia:"Australien",Asia:"Asien",Africa:"Afrika",SimpleMode:"Einfacher Modus",SatelliteMode:"Satelliten-Modus",GodMode:"Gott-Modus",LearnMode:"Lerner-Modus",Settings:"Einstellungen",Correct:"Richtig:",Wrong:"Falsch:",Click:"Klicken sie:",Restart:"Neustarten",AllAnswered:"Alle beantwortet",NextTask:"Nächste Aufgabe",Score:"Ergebnis",Congratulation:"Glückwunsch!"},fra:{CountryArea:"Superficie:",Minimum:"Minimum",HighlightAnswer:"Laisser les réponses correctes en surbrillance",NameTask:"Nom du pays",FlagTask:"Drapeau du pays",CapitalCity:"Capitale du pays",HintStart:"Afficher un indice après ",HintEnd:"suppositions erronées",America:"Amérique du Nord et Sud",Australia:"Australie",Asia:"Asie",Africa:"Afrique",SimpleMode:"Mode simple",SatelliteMode:"Mode sattelite",GodMode:"Mode DIEU",LearnMode:"Mode d'apprentissage",Settings:"Paramètres",Wrong:"Faux:",Click:"Cliquez sur:",Restart:"Recommencer",AllAnswered:"Tous répondu",NextTask:"Tâche suivante",Correct:"Correcte",Congratulation:"Félicitation!"}};var settings,countryData,correctAnswers=[],filteredData,taskCountry,highlightFeature,wrongCounter=0,wrongGuess=0,correctCounter=0,UNCODE="wb_a3_2",godModeActivated=!1,satLayer=new ol.layer.Tile({source:new ol.source.BingMaps({key:"AmEVj-KGhoWve5_QCHdobhC-iOs1YMk07Q60Of4KRejgJ40Dv9jzm-ZJmCIYUuPz",imagerySet:"aerial"})}),vectorLayer=new ol.layer.Vector({source:new ol.source.Vector({loader:function(){var a=this,b=new ol.format.TopoJSON;dojo.xhrGet({url:"data/countries_topojson.json",handleAs:"json",load:function(c){var d=b.readFeatures(c,{featureProjection:"EPSG:3857"});a.addFeatures(separateMultiPolygon(d))}})}}),style:function(a){return fillCountry(!0)}}),map=new ol.Map({layers:[vectorLayer],target:"map",view:new ol.View({center:ol.proj.fromLonLat([19,48]),extent:[-9999999999,-20920774,99999999999,18800987],zoom:5,maxZoom:11,minZoom:3})}),overlayFeature=new ol.layer.Vector({source:new ol.source.Vector,map:map,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(0,0,0,1)",width:2}),fill:new ol.style.Fill({color:"rgba(0,0,0,0.3)"})})}),correctAnswerFeature=new ol.layer.Vector({source:new ol.source.Vector,map:map,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0, 255, 0, 0.5)"})})}),hintFeature=new ol.layer.Vector({source:new ol.source.Vector,map:map,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.3)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 255, 1)",width:2})})});map.on("pointermove",function(a){if(!a.dragging){var b=map.getEventPixel(a.originalEvent);godModeActivated||highlightFeatureInfo(b)}}),map.on("click",function(a){checkCorrectAnswer(a.pixel)});
